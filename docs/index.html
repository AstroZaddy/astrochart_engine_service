<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Astrochart engine service API Demo</title>
</head>
<body>
  <h1>astrochart_engine_service API demo</h1>
  <p>Full details of the api and license information can be found at <a href="https://github.com/AstroZaddy/astrochart_engine_service.git">https://github.com/AstroZaddy/astrochart_engine_service.git</a></p>
  <p>astrochart_engine_service is distributed under the terms of the GNU Affero General Public License 
    version 3 or any later version. See git repository for further details</p>
  <form id="birth-form">
    <label>
      Date:
      <input name="datetime_utc" type="datetime-local" value="1990-07-14T21:15" required>
    </label><br/>
    <label>
      Latitude:
      <input name="latitude" type="number" step="0.0001" value="40.7128" required>
    </label><br/>
    <label>
      Longitude:
      <input name="longitude" type="number" step="0.0001" value="-74.0060" required>
    </label><br/>
    <button type="submit">Get Chart JSON</button>
  </form>
  <pre id="result" style="background:#f5f5f5; padding:1em;"></pre>

  <script>
    document.getElementById('birth-form').addEventListener('submit', async e => {
      e.preventDefault();
      const form = new FormData(e.target);
      const body = {};
      form.forEach((val, key) => body[key] = val);
      body.datetime_utc += 'Z';  // ensure ISO UTC
  
      const resultEl = document.getElementById('result');
      resultEl.textContent = 'Loading...';
  
      // Fetch chart data
      const chartResp = await fetch('/v1/build-chart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
      });
      let chartData;
      if (!chartResp.ok) {
        const err = await chartResp.json().catch(() => ({ detail: chartResp.statusText }));
        resultEl.textContent = `Chart error: ${err.detail || JSON.stringify(err)}`;
        return;
      }
      chartData = await chartResp.json();
  
      // Fetch lunar phases data
      const phaseResp = await fetch('/v1/lunar-phases', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ datetime_utc: body.datetime_utc }),
      });
      let phaseData;
      if (!phaseResp.ok) {
        const err = await phaseResp.json().catch(() => ({ detail: phaseResp.statusText }));
        resultEl.textContent = `Phases error: ${err.detail || JSON.stringify(err)}`;
        return;
      }
      phaseData = await phaseResp.json();
  
      // Display combined results
      resultEl.textContent =
        'Chart Data:\n' + JSON.stringify(chartData, null, 2) +
        '\n\nLunar Phases Data:\n' + JSON.stringify(phaseData, null, 2);
    });
  </script>
</body>
</html>

